<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://formspree.io; frame-src https://www.youtube.com https://player.vimeo.com; media-src 'self' https://www.youtube.com https://player.vimeo.com;">
    <title>Book a Tutor | Mobile Smart Teachers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        mst: {
                            orange: '#FF6600',
                            cyan: '#00CCFF',
                            yellow: '#FFCC00',
                            green: '#33CC33',
                            pink: '#FF3399',
                            black: '#000000',
                            gray: '#F3F4F6',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        .step-content.active {
            display: block;
        }
        .card-select {
            transition: all 0.2s ease;
        }
        .card-select.selected {
            border-color: #FF6600; /* MST Orange */
            background-color: #FFF7ED; /* Orange-50 */
            transform: translateY(-3px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative;
        }
        /* Dark mode specific selected state handled via JS classes usually, or simple overrides */
        .dark .card-select.selected {
            background-color: #431407; /* Orange-950 roughly */
            border-color: #FF6600;
        }

        /* Checkmark for selected services */
        .card-select.selected::after {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 10px;
            right: 10px;
            color: #FF6600;
            font-size: 1rem;
        }
        /* Level Cards */
        .level-card.selected {
            border-color: #00CCFF; /* MST Cyan */
            background-color: #E0F2FE; /* Sky-50 */
        }
        .dark .level-card.selected {
            background-color: #0c4a6e; /* Sky-900 */
            border-color: #00CCFF;
        }

        .subject-pill.selected {
            background-color: #00CCFF; /* MST Cyan */
            color: white;
            border-color: #00CCFF;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased flex flex-col min-h-screen dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- Navigation -->
    <nav class="bg-white shadow-md w-full z-50 dark:bg-gray-900 dark:border-b dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex-shrink-0 flex items-center">
                    <a href="index.html" class="flex items-center gap-3">
                        <img src="logo mst.jpg" alt="Mobile Smart Teachers Logo" class="h-16 w-auto object-contain">
                        <div class="flex flex-col">
                            <span class="font-bold text-2xl leading-none tracking-tight">
                                <span class="text-mst-orange">Mobile</span>
                                <span class="text-mst-cyan">Smart</span>
                            </span>
                            <span class="text-sm font-bold leading-none text-mst-yellow tracking-[0.2em] uppercase text-right">TEACHERS</span>
                        </div>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                     <!-- Navbar Search -->
                     <div class="nav-search-container">
                        <input type="text" id="nav-search-input" placeholder="Search...">
                        <button id="nav-search-btn" class="p-2">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>

                     <!-- Dark Mode Toggle -->
                     <button id="theme-toggle" class="text-gray-600 dark:text-yellow-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none rounded-lg text-sm p-2.5 transition-colors">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:inline"></i>
                    </button>

                    <div class="hidden md:flex items-center space-x-8">
                        <a href="index.html" class="text-gray-600 hover:text-mst-orange font-medium transition dark:text-gray-300 dark:hover:text-mst-orange">Home</a>
                        <a href="index.html#services" class="text-gray-600 hover:text-mst-green font-medium transition dark:text-gray-300 dark:hover:text-mst-green">Services</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            
            <!-- Progress Bar -->
            <div class="mb-10">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-bold text-mst-orange step-label">Services</span>
                    <span class="text-sm font-bold text-gray-400 dark:text-gray-500 step-label">Grade & Subjects</span>
                    <span class="text-sm font-bold text-gray-400 dark:text-gray-500 step-label">Details</span>
                </div>
                <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-mst-orange transition-all duration-500 ease-in-out" style="width: 33%"></div>
                </div>
            </div>

            <!-- Wizard Form -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden p-8 border border-gray-100 dark:border-gray-700 transition-colors duration-300">
                
                <!-- Step 1: Service Selection -->
                <div id="step-1" class="step-content active">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Select Services</h2>
                    <p class="text-gray-500 dark:text-gray-400 mb-8">You can select multiple services if needed.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <!-- 1. Academic Tuition -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-orange transition-all group flex items-center gap-4 dark:hover:border-mst-orange" onclick="toggleService('Academic Tuition', this)">
                            <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center text-mst-orange text-xl flex-shrink-0 group-hover:bg-mst-orange group-hover:text-white transition-colors">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Academic Tuition</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">One-on-one home tutoring.</p>
                            </div>
                        </div>
                        
                        <!-- 2. Online Learning -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-cyan transition-all group flex items-center gap-4 dark:hover:border-mst-cyan" onclick="toggleService('Online Learning', this)">
                            <div class="w-12 h-12 bg-cyan-100 dark:bg-cyan-900/30 rounded-full flex items-center justify-center text-mst-cyan text-xl flex-shrink-0 group-hover:bg-mst-cyan group-hover:text-white transition-colors">
                                <i class="fas fa-laptop"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Online Learning</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Virtual classes via Zoom.</p>
                            </div>
                        </div>

                        <!-- 3. Home Schooling -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-yellow transition-all group flex items-center gap-4 dark:hover:border-mst-yellow" onclick="toggleService('Home Schooling', this)">
                            <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center text-mst-yellow text-xl flex-shrink-0 group-hover:bg-mst-yellow group-hover:text-black transition-colors">
                                <i class="fas fa-home"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Home Schooling</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Full curriculum support.</p>
                            </div>
                        </div>

                        <!-- 4. Exam Prep -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-green transition-all group flex items-center gap-4 dark:hover:border-mst-green" onclick="toggleService('Exam Prep', this)">
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center text-mst-green text-xl flex-shrink-0 group-hover:bg-mst-green group-hover:text-white transition-colors">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Exam Prep</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">ECZ / GCE / IGCSE focus.</p>
                            </div>
                        </div>

                        <!-- 5. Study Skills -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-pink transition-all group flex items-center gap-4 dark:hover:border-mst-pink" onclick="toggleService('Study Skills', this)">
                            <div class="w-12 h-12 bg-pink-100 dark:bg-pink-900/30 rounded-full flex items-center justify-center text-mst-pink text-xl flex-shrink-0 group-hover:bg-mst-pink group-hover:text-white transition-colors">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Study Skills</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Time management & memory.</p>
                            </div>
                        </div>

                        <!-- 6. Career Guidance -->
                        <div class="card-select cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:border-mst-black transition-all group flex items-center gap-4 dark:hover:border-mst-black" onclick="toggleService('Career Guidance', this)">
                            <div class="w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center text-mst-black text-xl flex-shrink-0 group-hover:bg-mst-black group-hover:text-white transition-colors">
                                <i class="fas fa-compass"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg dark:text-gray-100">Career Guidance</h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400">For students & school leavers.</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button id="btn-next-1" disabled class="bg-gray-300 dark:bg-gray-700 text-white px-8 py-3 rounded-full font-bold cursor-not-allowed transition-colors" onclick="nextStep(2)">
                            Next Step <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Grade & Subject Selection -->
                <div id="step-2" class="step-content">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Select Grade Level</h2>
                    <p class="text-gray-500 dark:text-gray-400 mb-6">Which level is the student currently in?</p>

                    <!-- Grade Levels -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="card-select level-card cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center hover:border-mst-cyan transition-all" onclick="selectLevel(1, this)">
                            <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Primary</h3>
                            <p class="text-mst-orange font-semibold">Grade 5 - 7</p>
                        </div>
                        <div class="card-select level-card cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center hover:border-mst-cyan transition-all" onclick="selectLevel(2, this)">
                            <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Junior Secondary</h3>
                            <p class="text-mst-orange font-semibold">Grade 8 - 9</p>
                        </div>
                        <div class="card-select level-card cursor-pointer border-2 border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center hover:border-mst-cyan transition-all" onclick="selectLevel(3, this)">
                            <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Senior / GCE</h3>
                            <p class="text-mst-orange font-semibold">Grade 10 - 12 & School Leavers</p>
                        </div>
                    </div>

                    <!-- Subjects (Hidden until level selected) -->
                    <div id="subjects-section" class="hidden border-t dark:border-gray-700 pt-6 mt-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Select Subjects</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-4 text-sm" id="subject-instruction">Select the subjects for this level:</p>

                        <div class="flex flex-wrap gap-3 mb-8" id="subject-container">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button class="text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white font-medium px-4" onclick="prevStep(1)">
                            Back
                        </button>
                        <button id="btn-next-2" disabled class="bg-gray-300 dark:bg-gray-700 text-white px-8 py-3 rounded-full font-bold cursor-not-allowed transition-colors" onclick="nextStep(3)">
                            Next Step <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Details -->
                <div id="step-3" class="step-content">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Your Details</h2>
                    <p class="text-gray-500 dark:text-gray-400 mb-8">Almost done! Where can we reach you?</p>

                    <form id="booking-form" class="space-y-4 mb-8" onsubmit="submitBooking(event)">
                        <!-- Security: Honeypot field (hidden from humans) -->
                        <div class="hidden">
                            <label>Do not fill this out if you are human: <input name="_gotcha"></label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Name</label>
                            <input type="text" id="name" name="name" required pattern="[A-Za-z\s]+" title="Please enter letters and spaces only." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-mst-cyan focus:border-transparent outline-none transition" placeholder="Parent or Student Name">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone Number</label>
                                <input type="tel" id="phone" name="phone" required pattern="^\+?[0-9\s]+$" title="Please enter a valid phone number (digits and optional '+')." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-mst-cyan focus:border-transparent outline-none transition" placeholder="+260...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">City / Area</label>
                                <input type="text" id="location" name="location" required pattern="[A-Za-z0-9\s]+" title="Please enter letters, numbers, and spaces only." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-mst-cyan focus:border-transparent outline-none transition" placeholder="e.g. Lusaka, Woodlands">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Additional Notes (Optional)</label>
                            <textarea id="notes" name="notes" rows="3" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-mst-cyan focus:border-transparent outline-none transition" placeholder="Specific topics, preferred times..."></textarea>
                        </div>
                        
                        <div class="flex justify-between items-center mt-8">
                            <button type="button" class="text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white font-medium px-4" onclick="prevStep(2)">
                                Back
                            </button>
                            <button type="submit" class="bg-mst-black text-white px-8 py-3 rounded-full font-bold hover:bg-gray-800 dark:hover:bg-gray-700 transition shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                                Complete Booking
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Success Message -->
                <div id="step-success" class="step-content text-center py-12">
                    <div class="w-20 h-20 bg-green-100 dark:bg-green-900/30 text-mst-green rounded-full flex items-center justify-center mx-auto mb-6 text-4xl animate-bounce">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Booking Received!</h2>
                    <p class="text-gray-600 dark:text-gray-300 mb-8 max-w-md mx-auto">
                        Thank you for choosing Mobile Smart Teachers Enterprises. One of our coordinators will call you within 24 working hours.
                    </p>
                    <a href="index.html" class="bg-mst-orange text-white px-8 py-3 rounded-full font-bold hover:bg-orange-600 transition">
                        Return Home
                    </a>
                </div>

            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-mst-black text-gray-400 py-8 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>&copy; 2026 Mobile Smart Teachers. All Rights Reserved.</p> 
            <p>Designed by <a href="https://www.facebook.com/people/Brian-Simumba/100095513534854/" class="text-orange-100 hover:underline">Brian Simumba</a></p>
        </div>
    </footer>

    <!-- Logic -->
    <script>
        // --- Dark Mode Logic ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('color-theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('color-theme', 'dark');
            }
        }

        // Initialize Theme
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', toggleTheme);
        }

        // Data Store
        let bookingData = {
            services: [],
            level: null,
            subjects: []
        };

        const servicesRequiringSubjects = ['Academic Tuition', 'Online Learning', 'Home Schooling', 'Exam Prep'];

        // Subject Definitions
        const subjectsByLevel = {
            1: [ // Grade 5-7
                'Mathematics', 'English', 'Integrated Science', 'Social Studies', 
                'Technology Studies', 'Expressive Arts', 'Home Economics', 'Bemba (Local Language)'
            ],
            2: [ // Grade 8-9
                'Mathematics', 'English', 'Integrated Science', 'Social Studies', 
                'Business Studies', 'Computer Studies', 'Religious Education'
            ],
            3: [ // Grade 10-12 / GCE
                'Mathematics', 'English Language', 'Biology', 'Science (Physics/Chem)', 
                'Physics (Pure)', 'Chemistry (Pure)', 'Civic Education', 'History', 
                'Geography', 'Commerce', 'Accounts', 'Additional Mathematics', 'Literature'
            ]
        };

        function toggleService(service, element) {
            // Check if selected
            const index = bookingData.services.indexOf(service);
            
            if (index > -1) {
                // Deselect
                bookingData.services.splice(index, 1);
                element.classList.remove('selected');
            } else {
                // Select
                bookingData.services.push(service);
                element.classList.add('selected');
            }

            // Enable next button if at least one service is selected
            if (bookingData.services.length > 0) {
                enableButton('btn-next-1');
            } else {
                disableButton('btn-next-1');
            }
        }

        function selectLevel(levelId, element) {
            bookingData.level = levelId;
            bookingData.subjects = []; // Reset subjects when level changes
            
            // Visual feedback
            document.querySelectorAll('.level-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            // Populate Subjects
            const container = document.getElementById('subject-container');
            container.innerHTML = ''; // Clear existing

            const subjects = subjectsByLevel[levelId] || [];
            subjects.forEach(sub => {
                const pill = document.createElement('div');
                pill.className = 'subject-pill cursor-pointer border border-gray-300 dark:border-gray-600 px-4 py-2 rounded-full text-gray-600 dark:text-gray-300 hover:border-mst-cyan transition select-none text-sm';
                pill.textContent = sub;
                pill.onclick = () => toggleSubject(pill, sub);
                container.appendChild(pill);
            });

            // Show subjects section
            document.getElementById('subjects-section').classList.remove('hidden');
            
            // Disable next button until a subject is picked
            disableButton('btn-next-2');
        }

        function toggleSubject(element, subject) {
            if (bookingData.subjects.includes(subject)) {
                bookingData.subjects = bookingData.subjects.filter(s => s !== subject);
                element.classList.remove('selected');
            } else {
                bookingData.subjects.push(subject);
                element.classList.add('selected');
            }

            // Check if at least one subject selected
            if (bookingData.subjects.length > 0) {
                enableButton('btn-next-2');
            } else {
                disableButton('btn-next-2');
            }
        }

        function enableButton(btnId) {
            const btn = document.getElementById(btnId);
            btn.disabled = false;
            btn.classList.remove('bg-gray-300', 'cursor-not-allowed', 'dark:bg-gray-700');
            btn.classList.add('bg-mst-orange', 'hover:bg-orange-600');
        }

        function disableButton(btnId) {
            const btn = document.getElementById(btnId);
            btn.disabled = true;
            btn.classList.add('bg-gray-300', 'cursor-not-allowed', 'dark:bg-gray-700');
            btn.classList.remove('bg-mst-orange', 'hover:bg-orange-600');
        }

        function nextStep(step) {
            const needsSubjects = bookingData.services.some(s => servicesRequiringSubjects.includes(s));
            
            if (step === 2 && !needsSubjects) {
                showStep(3); // Skip to details
            } else {
                showStep(step);
            }
        }

        function prevStep(step) {
            const needsSubjects = bookingData.services.some(s => servicesRequiringSubjects.includes(s));
            
            if (step === 2 && !needsSubjects) {
                showStep(1); // Go back to services
            } else {
                showStep(step);
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            
            // Show target step
            document.getElementById(`step-${step}`).classList.add('active');

            // Update Progress Bar & Labels
            const progressBar = document.getElementById('progress-bar');
            const labels = document.querySelectorAll('.step-label');
            
            // Reset labels
            labels.forEach(l => {
                l.classList.remove('text-mst-orange');
                l.classList.add('text-gray-400', 'dark:text-gray-500');
            });

            if (step === 1) {
                progressBar.style.width = '33%';
                labels[0].classList.add('text-mst-orange');
                labels[0].classList.remove('text-gray-400', 'dark:text-gray-500');
            } else if (step === 2) {
                progressBar.style.width = '66%';
                labels[0].classList.add('text-mst-orange');
                labels[1].classList.add('text-mst-orange');
                labels[0].classList.remove('text-gray-400', 'dark:text-gray-500');
                labels[1].classList.remove('text-gray-400', 'dark:text-gray-500');
            } else if (step === 3) {
                progressBar.style.width = '100%';
                labels.forEach(l => {
                    l.classList.add('text-mst-orange');
                    l.classList.remove('text-gray-400', 'dark:text-gray-500');
                });
            }
        }

        async function submitBooking(e) {
            e.preventDefault();

            // Simple Rate Limiting
            const lastSubmission = localStorage.getItem('last_booking_time');
            const now = Date.now();
            if (lastSubmission && (now - lastSubmission < 60000)) {
                const remaining = Math.ceil((60000 - (now - lastSubmission)) / 1000);
                alert(`Please wait ${remaining} seconds before making another booking.`);
                return;
            }
            
            // Collect final data
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const location = document.getElementById('location').value;
            const notes = document.getElementById('notes').value;

            const finalData = {
                ...bookingData,
                name, 
                phone, 
                location, 
                notes,
                _subject: "New Booking from " + name // Custom subject line for Formspree
            };

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Processing...";

            // Controller for timeout
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

            try {
                // Using same Formspree endpoint as contact form
                const response = await fetch('https://formspree.io/f/xreaeyza', {
                    method: 'POST',
                    body: JSON.stringify(finalData),
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    localStorage.setItem('last_booking_time', Date.now());
                    // Show success
                    document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
                    document.getElementById('step-success').classList.add('active');
                    
                    // Hide progress bar for cleaner look
                    document.querySelector('.h-2').style.display = 'none';
                    window.scrollTo(0, 0);
                } else {
                    const data = await response.json();
                    alert(data.errors ? data.errors.map(error => error.message).join(", ") : "Error submitting booking.");
                }
            } catch (error) {
                alert("There was a problem submitting your booking. Please try again.");
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }

        // Handle URL Parameters (Auto-select service)
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const service = urlParams.get('service');
            
            if (service === 'career') {
                // Find Career Guidance card and click it
                const cards = document.querySelectorAll('.card-select h3');
                cards.forEach(card => {
                    if (card.textContent === 'Career Guidance') {
                        card.closest('.card-select').click();
                    }
                });
            }
        });
    </script>
</body>
</html>
